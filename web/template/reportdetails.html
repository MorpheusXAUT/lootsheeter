{{ define "reportdetails" }}
	{{ template "header" . }}
	{{ template "navigation" . }}
	
    {{ $ReportAdmin := or (IsReportCreator .Report) (HasAccessMask 256) }}
    
	<div class="container" role="main">
		<div class="page-header">
			<h1>Details for report #{{ .Report.Id }}</h1>
		</div>
		<div class="row">
			<div class="col-md">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3>Report</h3>
					</div>
					<div class="panel-body">
						<table class="table table-bordered">
							<thead>
								<th>Created By</th>
								<th>Total Payout</th>
								<th>Fleets Involved</th>
								<th>Start Range</th>
								<th>End Range</th>
								<th>Payout Complete</th>
							</thead>
							<tbody>
                            	<form role="form-horizontal" id="reportDetailsForm">
                                    <tr>
                                        <td>{{ .Report.Creator.Name }}</td>
                                        <td>{{ FormatFloat .Report.TotalPayout }} ISK</td>
                                        <td>{{ len .Report.Fleets }}</td>
                                        <td>{{ .Report.StartRange }}</td>
                                        <td>{{ .Report.EndRange }}</td>
                                        <td class="{{ if .Report.PayoutComplete }} success {{ else }} danger {{ end }}">
                                            <div id="reportDetailsPayoutComplete" report="{{ .Report.Id }}" class="report-details">
                                                {{ if .Fleet.PayoutComplete }} Done {{ else }} Outstanding {{ end }}
                                            </div>
                                            <div id="reportDetailsPayoutCompleteForm" report="{{ .Report.Id }}" style="display: none;" class="report-details">
                                                <select class="form-control" id="reportDetailsPayoutCompleteEdit" name="reportDetailsPayoutCompleteEdit">
                                                    <option value="false">Outstanding</option>
                                                    <option value="true">Done</option>
                                                </select>
                                            </div>
                                        </td>
                                    </tr>
                                </form>
							</tbody>
						</table>
						<p align="center">
                        	{{ if $ReportAdmin }}
                            <div id="reportMemberActions" report="{{ .Report.Id }}" align="center" class="report-details">
                                <a class="btn btn-primary report-details-toggle" report="{{ .Report.Id }}">Edit</a>
                                {{ if not .Report.PayoutComplete }}
								<a href="/report/{{ .Report.Id }}/finish" class="btn btn-danger">Finish Report</a>
								{{ end }}
                            </div>
                            <div id="reportMemberActions" report="{{ .Report.Id }}" style="display: none;" align="center" class="report-details">
                                <a class="btn btn-success report-details-save" report="{{ .Report.Id }}">Save</a>&nbsp;
                                <a class="btn btn-danger report-details-toggle" report="{{ .Report.Id }}">Cancel</a>
                            </div>
                            {{ end }}
						</p>
					</div>
					<div class="panel-heading">
						<h3>Report Fleets</h3>
					</div>
					<div class="panel-body">
						<table class="table table-striped">
							<thead>
								<tr>
									<th>#</th>
									<th>Name</th>
									<th>System</th>
									<th>Start Time</th>
									<th>End Time</th>
									<th>Surplus</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody>
								{{ range $fleet := .Report.Fleets }}
								<tr>
									<td><a href="/fleet/{{ $fleet.Id }}">{{ $fleet.Id }}</a></td>
									<td>{{ $fleet.Name }}</td>
									<td>{{ $fleet.System }}</td>
									<td>{{ $fleet.StartTime }}</td>
									<td>{{ $fleet.EndTime }}</td>
									<td>{{ FormatFloat $fleet.GetSurplus }} ISK</td>
									<td><a href="/fleet/{{ $fleet.Id }}" class="btn btn-default">View</a></td>
								</tr>
								{{ end }}
							</tbody>
						</table>
					</div>
					<div class="panel-heading">
						<h3>Report Players</h3>
					</div>
					<div class="panel-body">
						<table class="table table-striped">
							<thead>
								<tr>
									<th>Name</th>
									<th>Payout</th>
                                    <th>Payout Complete</th>
                                    <th>Action</th>
								</tr>
							</thead>
							<tbody>
								{{ range $name, $payout := .Report.Payouts }}
								<tr>
									<td>{{ $name }}</td>
									<td>{{ FormatFloat $payout.TotalPayout }} ISK</td>
                                    <td>{{ if $payout.PayoutComplete }} Done {{ else }} Outstanding {{ end }}</td>
                                    <td><a href="#" class="btn btn-success">Mark as paid</a></td>
								</tr>
								{{ end }}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	
    <script src="/js/reportdetails.js"></script>
    
	{{ template "footer" . }}
{{ end }}